<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:vm="using:Allva.Desktop.ViewModels"
             mc:Ignorable="d" d:DesignWidth="1200" d:DesignHeight="800"
             x:Class="Allva.Desktop.Views.LoginView"
             x:DataType="vm:LoginViewModel">

    <UserControl.Styles>
        <StyleInclude Source="LoginView.Styles.axaml"/>
    </UserControl.Styles>

    <Grid Background="#ffd966">
        
        <!-- Botón cambiar idioma -->
        <Button Classes="btnIdioma"
                Command="{Binding CambiarIdiomaCommand}"
                HorizontalAlignment="Right"
                VerticalAlignment="Top"
                Margin="0,30,30,0"
                ToolTip.Tip="Change language / Cambiar idioma">
            <TextBlock Classes="labelIdioma" 
                      Text="{Binding Localization.CurrentLanguageCode}"
                      HorizontalAlignment="Center"
                      VerticalAlignment="Center"/>
        </Button>

        <!-- Contenedor centrado -->
        <Grid HorizontalAlignment="Center" VerticalAlignment="Center">
            
            <!-- Panel de Login -->
            <Border Classes="panelLogin">
                
                <StackPanel Spacing="25">
                    
                    <!-- Logo -->
                    <Border Classes="logoContainer" 
                            HorizontalAlignment="Center"
                            Margin="0,0,0,15">
                        <Image Source="/Assets/logo-allva.png" 
                               Height="80"
                               Stretch="Uniform"/>
                    </Border>

                    <!-- Título -->
                    <TextBlock Classes="tituloLogin"
                              Text="{Binding Localization[Login_Title]}"
                              HorizontalAlignment="Center"/>

                    <!-- Mensaje de error -->
                    <Border Classes="mensajeError" 
                            IsVisible="{Binding MostrarError}">
                        <Grid ColumnDefinitions="Auto,*">
                            <Path Grid.Column="0" 
                                  Data="M12,8 L12,12 M12,16 L12,16 M12,2 C6.48,2 2,6.48 2,12 C2,17.52 6.48,22 12,22 C17.52,22 22,17.52 22,12 C22,6.48 17.52,2 12,2 Z"
                                  Stroke="#D32F2F"
                                  StrokeThickness="2"
                                  StrokeLineCap="Round"
                                  Fill="Transparent"
                                  Width="18"
                                  Height="18"
                                  Margin="0,0,10,0"/>
                            <TextBlock Grid.Column="1" 
                                      Text="{Binding MensajeError}"
                                      TextWrapping="Wrap"
                                      Classes="textoError"/>
                        </Grid>
                    </Border>

                    <!-- Formulario -->
                    <StackPanel Spacing="20">
                        
                        <!-- Campo: Usuario -->
                        <StackPanel Spacing="8">
                            <TextBlock Classes="labelCampo" 
                                      Text="{Binding Localization[Login_User]}"/>
                            <TextBox Classes="inputLogin"
                                    Text="{Binding NumeroUsuario}"
                                    Watermark="{Binding Localization[Login_UserPlaceholder]}"
                                    IsEnabled="{Binding !IsLoading}"
                                    HorizontalAlignment="Stretch">
                                <TextBox.InnerLeftContent>
                                    <Border Margin="10,0,0,0">
                                        <Path Data="M12,4 C14.21,4 16,5.79 16,8 C16,10.21 14.21,12 12,12 C9.79,12 8,10.21 8,8 C8,5.79 9.79,4 12,4 Z M5,20 L19,20 C19,16 16,14 12,14 C8,14 5,16 5,20 Z"
                                              Stroke="#666666"
                                              StrokeThickness="1.5"
                                              StrokeLineCap="Round"
                                              Fill="Transparent"
                                              Width="18"
                                              Height="18"/>
                                    </Border>
                                </TextBox.InnerLeftContent>
                            </TextBox>
                        </StackPanel>

                        <!-- Campo: Código Local -->
                        <StackPanel Spacing="8">
                            <TextBlock Classes="labelCampo" 
                                      Text="{Binding Localization[Login_Office]}"/>
                            <TextBox Classes="inputLogin"
                                    Text="{Binding CodigoLocal}"
                                    Watermark="{Binding Localization[Login_OfficePlaceholder]}"
                                    IsEnabled="{Binding !IsLoading}"
                                    HorizontalAlignment="Stretch">
                                <TextBox.InnerLeftContent>
                                    <Border Margin="10,0,0,0">
                                        <Path Data="M3,9 L21,9 L21,20 C21,20.55 20.55,21 20,21 L4,21 C3.45,21 3,20.55 3,20 L3,9 Z M8,5 L8,7 M12,5 L12,7 M16,5 L16,7 M3,5 L21,5 C21.55,5 22,5.45 22,6 L22,8 C22,8.55 21.55,9 21,9 L3,9 C2.45,9 2,8.55 2,8 L2,6 C2,5.45 2.45,5 3,5 Z"
                                              Stroke="#666666"
                                              StrokeThickness="1.5"
                                              StrokeLineCap="Round"
                                              Fill="Transparent"
                                              Width="18"
                                              Height="18"/>
                                    </Border>
                                </TextBox.InnerLeftContent>
                            </TextBox>
                        </StackPanel>

                        <!-- Campo: Contraseña -->
                        <StackPanel Spacing="8">
                            <TextBlock Classes="labelCampo" 
                                      Text="{Binding Localization[Login_Password]}"/>
                            <TextBox Classes="inputLogin"
                                    Text="{Binding Password}"
                                    PasswordChar="●"
                                    Watermark="{Binding Localization[Login_PasswordPlaceholder]}"
                                    IsEnabled="{Binding !IsLoading}"
                                    HorizontalAlignment="Stretch">
                                <TextBox.InnerLeftContent>
                                    <Border Margin="10,0,0,0">
                                        <Path Data="M6,10 L6,8 C6,5.79 7.79,4 10,4 L14,4 C16.21,4 18,5.79 18,8 L18,10 M12,16 C13.1,16 14,15.1 14,14 C14,12.9 13.1,12 12,12 C10.9,12 10,12.9 10,14 C10,15.1 10.9,16 12,16 Z M4,10 L20,10 C21.1,10 22,10.9 22,12 L22,20 C22,21.1 21.1,22 20,22 L4,22 C2.9,22 2,21.1 2,20 L2,12 C2,10.9 2.9,10 4,10 Z"
                                              Stroke="#666666"
                                              StrokeThickness="1.5"
                                              StrokeLineCap="Round"
                                              Fill="Transparent"
                                              Width="18"
                                              Height="18"/>
                                    </Border>
                                </TextBox.InnerLeftContent>
                            </TextBox>
                        </StackPanel>

                        <!-- Checkbox: Recordar sesión -->
                        <CheckBox Content="{Binding Localization[Login_Remember]}"
                                 IsChecked="{Binding RecordarSesion}"
                                 Classes="checkboxRecordar"
                                 IsEnabled="{Binding !IsLoading}"/>

                    </StackPanel>

                    <!-- Botón iniciar sesión -->
                    <Button Classes="btnLogin"
                            Command="{Binding LoginCommand}"
                            IsEnabled="{Binding !IsLoading}">
                        
                        <Grid>
                            <!-- Texto normal -->
                            <TextBlock Text="{Binding Localization[Login_Button]}"
                                      IsVisible="{Binding !IsLoading}"
                                      HorizontalAlignment="Center"/>
                            
                            <!-- LOADING CON PUNTOS ANIMADOS -->
                            <StackPanel Orientation="Horizontal" 
                                       HorizontalAlignment="Center"
                                       Spacing="8"
                                       IsVisible="{Binding IsLoading}">
                                <TextBlock Text="{Binding Localization[Login_Loading]}"
                                          FontSize="16"
                                          FontWeight="Bold"
                                          VerticalAlignment="Center"/>
                                <StackPanel Orientation="Horizontal" Spacing="4">
                                    <Ellipse Width="8" Height="8" Fill="White">
                                        <Ellipse.Styles>
                                            <Style Selector="Ellipse">
                                                <Style.Animations>
                                                    <Animation Duration="0:0:1" IterationCount="Infinite">
                                                        <KeyFrame Cue="0%">
                                                            <Setter Property="Opacity" Value="0.3"/>
                                                        </KeyFrame>
                                                        <KeyFrame Cue="33%">
                                                            <Setter Property="Opacity" Value="1"/>
                                                        </KeyFrame>
                                                        <KeyFrame Cue="100%">
                                                            <Setter Property="Opacity" Value="0.3"/>
                                                        </KeyFrame>
                                                    </Animation>
                                                </Style.Animations>
                                            </Style>
                                        </Ellipse.Styles>
                                    </Ellipse>
                                    <Ellipse Width="8" Height="8" Fill="White">
                                        <Ellipse.Styles>
                                            <Style Selector="Ellipse">
                                                <Style.Animations>
                                                    <Animation Duration="0:0:1" IterationCount="Infinite" Delay="0:0:0.2">
                                                        <KeyFrame Cue="0%">
                                                            <Setter Property="Opacity" Value="0.3"/>
                                                        </KeyFrame>
                                                        <KeyFrame Cue="33%">
                                                            <Setter Property="Opacity" Value="1"/>
                                                        </KeyFrame>
                                                        <KeyFrame Cue="100%">
                                                            <Setter Property="Opacity" Value="0.3"/>
                                                        </KeyFrame>
                                                    </Animation>
                                                </Style.Animations>
                                            </Style>
                                        </Ellipse.Styles>
                                    </Ellipse>
                                    <Ellipse Width="8" Height="8" Fill="White">
                                        <Ellipse.Styles>
                                            <Style Selector="Ellipse">
                                                <Style.Animations>
                                                    <Animation Duration="0:0:1" IterationCount="Infinite" Delay="0:0:0.4">
                                                        <KeyFrame Cue="0%">
                                                            <Setter Property="Opacity" Value="0.3"/>
                                                        </KeyFrame>
                                                        <KeyFrame Cue="33%">
                                                            <Setter Property="Opacity" Value="1"/>
                                                        </KeyFrame>
                                                        <KeyFrame Cue="100%">
                                                            <Setter Property="Opacity" Value="0.3"/>
                                                        </KeyFrame>
                                                    </Animation>
                                                </Style.Animations>
                                            </Style>
                                        </Ellipse.Styles>
                                    </Ellipse>
                                </StackPanel>
                            </StackPanel>
                        </Grid>
                    </Button>

                    <!-- Enlace: Olvidé mi contraseña -->
                    <Button Classes="btnRecuperarPassword"
                            Command="{Binding RecuperarPasswordCommand}"
                            IsEnabled="{Binding !IsLoading}"
                            HorizontalAlignment="Center"
                            Content="{Binding Localization[Login_ForgotPassword]}"/>

                    <!-- Versión -->
                    <Grid ColumnDefinitions="*,Auto">
                        <StackPanel Grid.Column="0" Orientation="Horizontal" Spacing="5">
                            <TextBlock Classes="textoVersion"
                                      Text="{Binding Localization[Login_Version]}"/>
                            <TextBlock Classes="textoVersion"
                                      Text="1.0.0"/>
                        </StackPanel>
                        <Button Grid.Column="1"
                               Classes="btnSoporte"
                               Content="{Binding Localization[Login_Support]}"
                               HorizontalAlignment="Right"/>
                    </Grid>

                </StackPanel>
            </Border>

            <!-- OVERLAY DE CARGA GRANDE Y VISIBLE -->
            <Border Background="#DD000000" 
                    IsVisible="{Binding IsLoading}"
                    HorizontalAlignment="Stretch"
                    VerticalAlignment="Stretch"
                    CornerRadius="25">
                <StackPanel HorizontalAlignment="Center" 
                           VerticalAlignment="Center"
                           Spacing="30">
                    
                    <!-- Círculos animados grandes -->
                    <StackPanel Orientation="Horizontal" 
                               Spacing="15"
                               HorizontalAlignment="Center">
                        <Ellipse Width="20" Height="20" Fill="#ffd966">
                            <Ellipse.Styles>
                                <Style Selector="Ellipse">
                                    <Style.Animations>
                                        <Animation Duration="0:0:1.2" IterationCount="Infinite">
                                            <KeyFrame Cue="0%">
                                                <Setter Property="Opacity" Value="0.2"/>
                                            </KeyFrame>
                                            <KeyFrame Cue="50%">
                                                <Setter Property="Opacity" Value="1"/>
                                            </KeyFrame>
                                            <KeyFrame Cue="100%">
                                                <Setter Property="Opacity" Value="0.2"/>
                                            </KeyFrame>
                                        </Animation>
                                    </Style.Animations>
                                </Style>
                            </Ellipse.Styles>
                        </Ellipse>
                        <Ellipse Width="20" Height="20" Fill="#ffd966">
                            <Ellipse.Styles>
                                <Style Selector="Ellipse">
                                    <Style.Animations>
                                        <Animation Duration="0:0:1.2" IterationCount="Infinite" Delay="0:0:0.3">
                                            <KeyFrame Cue="0%">
                                                <Setter Property="Opacity" Value="0.2"/>
                                            </KeyFrame>
                                            <KeyFrame Cue="50%">
                                                <Setter Property="Opacity" Value="1"/>
                                            </KeyFrame>
                                            <KeyFrame Cue="100%">
                                                <Setter Property="Opacity" Value="0.2"/>
                                            </KeyFrame>
                                        </Animation>
                                    </Style.Animations>
                                </Style>
                            </Ellipse.Styles>
                        </Ellipse>
                        <Ellipse Width="20" Height="20" Fill="#ffd966">
                            <Ellipse.Styles>
                                <Style Selector="Ellipse">
                                    <Style.Animations>
                                        <Animation Duration="0:0:1.2" IterationCount="Infinite" Delay="0:0:0.6">
                                            <KeyFrame Cue="0%">
                                                <Setter Property="Opacity" Value="0.2"/>
                                            </KeyFrame>
                                            <KeyFrame Cue="50%">
                                                <Setter Property="Opacity" Value="1"/>
                                            </KeyFrame>
                                            <KeyFrame Cue="100%">
                                                <Setter Property="Opacity" Value="0.2"/>
                                            </KeyFrame>
                                        </Animation>
                                    </Style.Animations>
                                </Style>
                            </Ellipse.Styles>
                        </Ellipse>
                    </StackPanel>
                    
                    <!-- Texto grande y visible -->
                    <TextBlock Text="Verificando credenciales..."
                              Foreground="#ffd966"
                              FontSize="20"
                              FontWeight="Bold"
                              HorizontalAlignment="Center"/>
                              
                    <TextBlock Text="Por favor espera un momento"
                              Foreground="White"
                              FontSize="14"
                              HorizontalAlignment="Center"
                              Opacity="0.8"/>
                </StackPanel>
            </Border>

        </Grid>

        <!-- Copyright -->
        <TextBlock Classes="textoCopyright"
                  Text="{Binding Localization[Login_Copyright]}"
                  HorizontalAlignment="Center"
                  VerticalAlignment="Bottom"
                  Margin="0,0,0,20"/>

    </Grid>

</UserControl>